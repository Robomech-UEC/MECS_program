---
title: 様々な通信
parent: 通信

nav_order: 5

author: 丸山響輝
last_modified_at: true
state: editing
---

# **様々な通信**
{: .no_toc }

## 目次
{: .no_toc .text-delta }

1. TOC
{:toc}

## OSI参照モデル
Open System Interconnection Reference Model  
通信を7つの階層に分割する考え方を指します。これにより通信の保守性が上がり、また規格を一般化することが出来ました。この企画はISOが提唱しているものです。  
まずはこれらの階層を説明します。  

|レイヤ|階層名|役割|
|---|---|---|
|L1|物理層|ビットを物理信号に変換|
|L2|データリンク層|MACアドレスなどを用い、同一ネットワーク上でフレーム通信を行う|
|L3|ネットワーク層|IPアドレスに基づき、異なるネットワーク上でパケットを転送|
|L4|トランスポート層|end to endの信頼性(順序、再送)|
|L5|セッション層|通信の開始、維持、終了、再開|
|L6|プレゼンテーション層|データの表現形式(暗号、圧縮、文字コード)|
|L7|アプリケーション層|アプリケーションとネットワークの接続|

一般にひとつの機械システムの中で使われる通信システムは、このうちレイヤー2までを含んでいます。  
つまり、  
物理層=通信線の数や電圧、データリンク層=アドレスの指定方法や誤り検出  
となっているということです。  
これより上のレイヤ―については[象-software](../../../005_software/index)で扱う、無線通信を見てください。

## デジタル信号
物理世界はアナログです。あらゆる現象、信号などは無限大の分解能をもっています。それに対し、機械はデジタルの信号のみを扱っています。デジタルの世界では小数点以下の数値は浮動小数点、という01の羅列で表現され、分解能が有限の値なのです。  
そして、電気回路で大事になるのはいかにしてデジタル値でアナログ値を表現するか、ということです。

### GPIO
主にデジタル信号を送受信するのはマイコンです。マイコンには主に電源とGPIO(general purpose input output)と呼ばれるピンがあり、これらのピンから任意の信号を出力することができます。  
出力できる信号は基本的には2種類で、HIGHとLOWです。LOWはマイコンのGNDと同じレベルにピンの電圧を落とすこと、HIGHは逆にマイコンでHIGHとされる電圧までピンを引き上げることです。大抵このHIGHは3.3Vになっています。Arduinoなど5Vのものもあります。

### 信号の受信
GPIOによるHIGH/LOW信号の受け取り方は主に2種類あります。
- ボーリング  
時間ごとにピンの信号を読み取り、動作を変更する受信方法。状態としてHIGH/LOWが存在する時に有効。
- 割り込み
ピンがHIGH/LOWに変化した場合に動作を行う受信方法。信号の変化に対して即座に動作ができる。高い反応性が必要な場合や、リミットスイッチなど一度しか動作しないものを読み取る場合に有効。

### PWM
マイコンがアナログ信号をデジタルとして送る方法はいくつかありますが、その中でもっとも単純なのがPWM(pulse width modulation)信号です。日本語ではパルス幅変調といいます。  
原理は単純で、アナログの値をHIGHとLOWの割合で示したものです。サーボモータの角度(速度)指定などによく用いられ、大抵50Hzか60Hzで動作しています。信号の1周期の中にHIGHの時間が何割含まれているかを送信するものです。  
精度はあまりよくなく、とりあえず動けばいいところに用いる印象です。あと、配線も複雑になってしまいます。利点としてはPWM信号で動くアクチュエータは安価であるということが挙げられます。


## シリアル通信
シリアル通信とは、通信を1本の線で行う方法です。対義語はパラレル通信と呼ばれ、こちらは複数の信号線を用いて同時にデータ通信を行いますが、現在はほとんどがシリアル通信となっています。  
シリアル通信の利点は、データ信号のずれが少ないことです。これにより、通信速度を速めることが出来ます。  
このような通信方式をマスタースレーブ通信と呼び、どちらかがメインとなり通信をはじめ、スレーブは通信を受け取り、返信をします。

### デイジーチェーン
シリアルデバイスを複数つなげることをデイジーチェーンと呼びます。  
これにより、マスターのデバイスから大量の配線を生やすことなくデバイスを動作させることが可能になるとともに、回路やプログラムのコードの簡略化、エラーの防止につながります。

### I2C
Inter-Integrated Circuit  

物理層  

|信号線|接続先|役割|
|---|---|---|
|SDA(Serial Data)|SDA|データ線|
|SDC(Serial Clock)|SDC|Masterが生成するClock信号|

![spi](imgs/005_i2c.png)  

通信はSDCのClock信号に従って行われます。  
SDAにデータを流す際にデバイスのidから始めることで通信相手を選択しています。  
大量のslaveとある程度高速に通信することが出来るため、使いやすいです。  
主にセンサーや、ledコントローラーなど多少複雑な動作をするチップに使われることが多いです。  
デイジーチェーンで使うことが出来ますが、あまりやらないイメージです。

### SPI
Serial Peripheral Interface  

物理層  

|信号線|接続先|役割|
|---|---|---|
|MOSI(Master Out Slave In)|SDI(slave data in)|master -> slave 方向の通信|
|MISO(Master In Slave Out)|SDO(slave data out)|slave -> master 方向の通信|
|SCLK(Serial Clock)|SCLK|Masterが生成するclock信号|
|SS(Slave Select)|SS|slaveのデバイスを選択|

SSはCS(Chip Select)と呼ばれることもあります。

![spi](imgs/005_spi.png)  

I2C同様マスターが発するclock信号に従って通信が行われます。  
1度に1つのslaveとのみ通信が可能で、対象のslaveにつながれたSS信号をlowにすることで通信対象を選択します。
このような動作方法を"active low"と呼びます。  
大量のslaveと通信するためには向いていませんが、入出力が別の線で駆動されるため小数のslaveと高速で通信を行う場合に適しているとされています。  
I2Cと比べデータの入出力が別の線になっており、またアドレス指定が必要ないため高速に通信が可能です。
基本的に1対1で少数の高速通信が必要なセンサや、SDカードなどと通信する場合に用いられています。  

頑張ればデイジーチェーンのようにして使うこともできるらしいです。

### RS485


### ICS
### CAN

### UART

## USB通信
